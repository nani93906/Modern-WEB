<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T8C6RVQM');
  </script>

  <meta charset="UTF-8" />
  <title>Modern Web | Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="styles.css" />
  <style>
    .login-box { display:none; max-width:300px; margin:20px auto; }
    .login-box input { width:100%; padding:8px; margin:6px 0; }
    .login-box button { width:100%; padding:8px; }
    .user-info { display:none; text-align:center; margin:20px; }
  </style>

  <!-- Adobe digitalData -->
  <script>
    window.digitalData = {
      page: {
        pageInfo: {
          pageName: "Home",
          pageURL: location.href
        }
      },
      user: {
        isLoggedIn: false
      },
      event: []
    };
  </script>

  <!-- GTM Page View -->
  <script>
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
      event: "page_view",
      page_name: "Home"
    });
  </script>
</head>

<body>

<header>
  <h2 style="text-align:center">Modern Web Design</h2>
  <nav style="text-align:center">
    <a href="#">Home</a> |
    <a href="#">Shop</a> |
    <a href="#">Cart</a> |
    <a href="#" id="loginNav">Sign In</a> |
    <a href="#" id="logoutNav" style="display:none;">Sign Out</a>
  </nav>
</header>

<!-- LOGIN FORM -->
<div class="login-box" id="loginBox">
  <h3>Sign In</h3>
  <input type="email" id="email" placeholder="Email" required />
  <input type="password" id="password" placeholder="Password" required />
  <button id="loginBtn">Login</button>
  <p id="loginError" style="color:red; display:none;">Invalid credentials</p>
</div>

<!-- USER INFO -->
<div class="user-info" id="userInfo">
  <h3>Welcome, <span id="userName"></span></h3>
  <p>You are logged in.</p>
</div>

<script>
  const loginBox = document.getElementById("loginBox");
  const userInfo = document.getElementById("userInfo");
  const loginNav = document.getElementById("loginNav");
  const logoutNav = document.getElementById("logoutNav");

  const storedUser = JSON.parse(localStorage.getItem("user"));

  // ---------- PAGE LOAD SESSION CHECK ----------
  if (storedUser) {
    setLoggedInState(storedUser);
  }

  // ---------- SHOW LOGIN ----------
  loginNav.addEventListener("click", (e) => {
    e.preventDefault();
    loginBox.style.display = "block";
  });

  // ---------- LOGIN ----------
  document.getElementById("loginBtn").addEventListener("click", () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    // Dummy validation (real sites validate from backend)
    if (email === "user@test.com" && password === "123456") {

      const user = {
        email,
        firstName: "Durga",
        lastName: "Maddipatla"
      };

      localStorage.setItem("user", JSON.stringify(user));
      setLoggedInState(user);

      // Adobe Analytics
      digitalData.user = { isLoggedIn: true, email };
      digitalData.event.push({
        event: "userLogin",
        eventInfo: { method: "email" }
      });

      // GTM
      window.dataLayer.push({
        event: "login",
        login_method: "email",
        user_email: email
      });

    } else {
      document.getElementById("loginError").style.display = "block";
    }
  });

  // ---------- LOGOUT ----------
  logoutNav.addEventListener("click", (e) => {
    e.preventDefault();

    localStorage.removeItem("user");

    digitalData.user.isLoggedIn = false;
    digitalData.event.push({ event: "userLogout" });

    window.dataLayer.push({ event: "logout" });

    loginBox.style.display = "none";
    userInfo.style.display = "none";
    loginNav.style.display = "inline";
    logoutNav.style.display = "none";
  });

  // ---------- UI STATE ----------
  function setLoggedInState(user) {
    loginBox.style.display = "none";
    userInfo.style.display = "block";
    document.getElementById("userName").innerText = user.firstName;
    loginNav.style.display = "none";
    logoutNav.style.display = "inline";
  }
</script>

</body>
</html>
